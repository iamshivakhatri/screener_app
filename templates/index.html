<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Data Dashboard</title>
    <!-- Include Tailwind CSS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Include Tabulator CSS from CDN -->
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator.min.css" rel="stylesheet">
    <link href="{{url_for('static', filename='css/output.css')}}" rel="stylesheet">
</head>
<style>
 #gainers-table{
    width: 400px;
}
#active-table{
    width: 400px;
}

</style>
<body class="bg-gray-400 text-gray-100 font-sans antialiased">

  

    <main class="container p-6 flex ">
        <section class=" flex-1">
                <div>
                <!-- <h3 class="text-2xl font-semibold mb-4 text-gray-100">Gainers</h3> -->
                <div id="gainers-table" class="mb-2"></div>
                </div>

                <div>
                <!-- <h3 class="text-2xl font-semibold mb-4 text-gray-100">Active Stocks</h3> -->
                <div id="active-table" class="mb-2"></div>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg space-y-6">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-100">News</h3>
                    <ul id="news-container" class="list-disc pl-5 text-gray-300">
                        <!-- News items will be inserted here -->
                    </ul>
                </div>
                

        </section>
        <section class="flex-1">
            <div></div>
        </section>

        
    </main>

    <!-- Include Tabulator JS from CDN -->
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const gainersData = {{ gainers | tojson | safe }};
            const activeData = {{ active | tojson | safe }};
            
            console.log(gainersData);
            console.log(activeData);
    
            // Initialize Gainers table with hard-coded column names
            var gainersTable = new Tabulator("#gainers-table", {
                layout: "fitColumns",
                columns: [
                    { title: "Symbol",
                     field: "symbol",
                    
                    },
                    { title: "Name", field: "name" },
                    { title: "Change", field: "change" },
                    { title: "Price", field: "price" },
                    { title: "% C",
                     field: "changesPercentage" ,
                     formatter: function(cell, formatterParams, onRendered){
                            let row = cell.getRow();
                            let pc = cell.getValue();
                            row.getElement().style.color = "darkgreen";
                           
                            return pc;
                            
                        },
                    },
                    
                ],
               
                data: gainersData,
            });

            gainersTable.on("rowClick", function(e, row) {
                console.log("Row Clicked:", row.getData());
            });


    
            // Initialize Active Stocks table
            var activeTable = new Tabulator("#active-table", {
                layout: "fitColumns",
                width: 400,
                columns: [
                    { title: "Symbol", field: "symbol" },
                    { title: "Name", field: "name" },
                    { title: "Price", field: "price"},
                    { title: "Change", field: "change" },
                    { title: "% C", field: "changesPercentage",
              
                     formatter: function(cell, formatterParams, onRendered){
                            let row = cell.getRow();
                            let pc = cell.getValue();
                            row.getElement().style.color = "darkgreen";
                           
                            return pc;
                            
                        },
                    },
                 
                ],
                data: activeData,
                
            });
            activeTable.on("rowClick", function(e, row) {
                console.log("Row Clicked:", row.getData().symbol);
                get_news(row.getData().symbol);
             });

        });

        
        async function get_news(ticker){
        const response = await fetch(`/news/${ticker}`);
        const data = await response.json();
        console.log(data);

        const newsContainer = document.getElementById('news-container');
        newsContainer.innerHTML = ''; // Clear previous news

        data.forEach(news_item => {
            const listItem = document.createElement('li');
            listItem.classList.add('mb-4');

            const link = document.createElement('a');
            link.href = news_item.url;
            link.target = '_blank';
            link.classList.add('text-blue-400', 'hover:underline');
            link.textContent = news_item.title;

            const summary = document.createElement('p');
            summary.classList.add('mt-1');
            summary.textContent = news_item.summary;

            listItem.appendChild(link);
            listItem.appendChild(summary);
            newsContainer.appendChild(listItem);
        });
}

    </script>
</body>
</html>
